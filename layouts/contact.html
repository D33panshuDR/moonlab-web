{{ define "main" }}
<main class="pt-32 pb-20">
    <div class="max-w-7xl mx-auto px-6">
        
        {{/* 1. Header Section */}}
        <div class="mb-20 reveal">
            <h1 class="font-title text-6xl md:text-8xl mb-6">{{ .Title }}</h1>
            <p class="text-xs text-lab-muted max-w-xl leading-relaxed border-l-2 border-lab-accent pl-4">
                {{ .Params.description }}
            </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-16">
            
            {{/* 2. Left Column: Contact Info */}}
            <div class="lg:col-span-5 space-y-12 reveal">
                
                {{/* Direct Lines */}}
                <div>
                    <h3 class="font-title text-2xl mb-6 border-b border-lab-border pb-2">Direct Lines</h3>
                    <ul class="space-y-6">
                        {{ range .Params.contact_list }}
                        <li>
                            <span class="block text-[10px] font-bold text-lab-muted uppercase tracking-widest mb-1">
                                {{ .label }}
                            </span>
                            <a href="mailto:{{ .email }}" class="text-lg hover:text-lab-accent transition-colors">
                                {{ .email }}
                            </a>
                            {{ with .note }}
                                <p class="text-[10px] text-lab-muted mt-1 italic">{{ . }}</p>
                            {{ end }}
                        </li>
                        {{ end }}
                    </ul>
                </div>

                {{/* Location */}}
                <div>
                    <h3 class="font-title text-2xl mb-6 border-b border-lab-border pb-2">Location</h3>
                    <address class="not-italic text-sm leading-relaxed mb-6">
                        <strong>{{ .Params.location.title }}</strong><br>
                        {{ .Params.location.address | safeHTML }}
                    </address>
                    
                    {{ with .Params.visitor_info }}
                    <div class="bg-white p-4 border border-lab-border">
                        <span class="block text-[10px] font-bold text-lab-accent uppercase mb-2">
                            {{ .title }}
                        </span>
                        <p class="text-[10px] text-lab-muted leading-relaxed">
                            {{ .text }}
                        </p>
                    </div>
                    {{ end }}
                </div>

            </div>

            {{/* 3. Right Column: Contact Form */}}
            <div class="lg:col-span-7 bg-white p-8 md:p-12 border border-lab-border reveal" style="transition-delay: 100ms;">
                <h3 class="font-title text-3xl mb-8">Send a Message</h3>
                
                <form class="space-y-6" action="#" method="POST">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="fname" class="block text-[10px] font-bold text-lab-muted uppercase tracking-widest mb-2">First Name</label>
                            <input type="text" id="fname" name="firstname" class="w-full bg-lab-bg border border-lab-border p-3 text-sm focus:outline-none focus:border-lab-accent transition-colors">
                        </div>
                        <div>
                            <label for="lname" class="block text-[10px] font-bold text-lab-muted uppercase tracking-widest mb-2">Last Name</label>
                            <input type="text" id="lname" name="lastname" class="w-full bg-lab-bg border border-lab-border p-3 text-sm focus:outline-none focus:border-lab-accent transition-colors">
                        </div>
                    </div>

                    <div>
                        <label for="email" class="block text-[10px] font-bold text-lab-muted uppercase tracking-widest mb-2">Email Address</label>
                        <input type="email" id="email" name="email" class="w-full bg-lab-bg border border-lab-border p-3 text-sm focus:outline-none focus:border-lab-accent transition-colors">
                    </div>

                    <div>
                        <label for="topic" class="block text-[10px] font-bold text-lab-muted uppercase tracking-widest mb-2">Topic</label>
                        <select id="topic" name="topic" class="w-full bg-lab-bg border border-lab-border p-3 text-sm focus:outline-none focus:border-lab-accent transition-colors">
                            {{ range .Params.form.topics }}
                                <option value="{{ . }}">{{ . }}</option>
                            {{ end }}
                        </select>
                    </div>

                    <div>
                        <label for="message" class="block text-[10px] font-bold text-lab-muted uppercase tracking-widest mb-2">Message</label>
                        <textarea id="message" name="message" rows="6" class="w-full bg-lab-bg border border-lab-border p-3 text-sm focus:outline-none focus:border-lab-accent transition-colors"></textarea>
                    </div>

                    <button type="submit" class="px-8 py-4 bg-lab-text text-white text-xs font-bold uppercase tracking-widest hover:bg-lab-accent transition-colors w-full md:w-auto">
                        Send 
                    </button>
                </form>
            </div>

        </div>
        
        <div class="mt-20 border border-lab-border reveal">
            <div class="w-full h-[400px] bg-gray-200 relative overflow-hidden group">
                
               
                {{ $lat := .Params.map.coordinates.lat }}
                {{ $lng := .Params.map.coordinates.lng }}
                {{ $offset := .Params.map.zoom_offset | default 0.004 }}
                
                {{ $minLon := sub $lng $offset }}
                {{ $minLat := sub $lat $offset }}
                {{ $maxLon := add $lng $offset }}
                {{ $maxLat := add $lat $offset }}
                
                {{/* Construct Dynamic URL */}}
                {{ $src := printf "https://www.openstreetmap.org/export/embed.html?bbox=%f,%f,%f,%f&layer=mapnik&marker=%f,%f" $minLon $minLat $maxLon $maxLat $lat $lng }}
                {{ $largeMap := printf "https://www.openstreetmap.org/?mlat=%f&mlon=%f#map=16/%f/%f" $lat $lng $lat $lng }}

                {{/* OpenStreetMap Iframe */}}
                <iframe 
                    width="100%" 
                    height="100%" 
                    frameborder="0" 
                    scrolling="no" 
                    marginheight="0" 
                    marginwidth="0" 
                    src="{{ $src | safeURL }}" 
                    class="w-full h-full  transition-all duration-700 ease-in-out z-0"
                    title="Lab Location"
                ></iframe>

                <div class="absolute inset-0 flex items-center justify-center pointer-events-none pb-14">
                    <div class="bg-white px-4 py-2 border border-lab-border shadow-xl z-10 relative">
                        <span class="text-xs font-bold text-lab-text whitespace-nowrap">
                            {{ .Params.map.label }}
                        </span>
                       
                        <div class="absolute -bottom-2 left-1/2 -translate-x-1/2 w-0 h-0 border-l-[6px] border-l-transparent border-r-[6px] border-r-transparent border-t-8 border-t-white"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>

</main>
{{ end }}