{{ define "main" }}
<main class="pt-32 pb-24 bg-white min-h-screen">
    <div class="max-w-7xl mx-auto px-6">
        
        <div class="text-center mb-16 reveal">
            <h1 class="font-title text-5xl md:text-7xl font-bold mb-6 text-lab-text">Our Team</h1>
            <p class="text-lab-muted text-lg max-w-2xl mx-auto">
                Meet the researchers, engineers, and students behind Moon Lab.
            </p>
        </div>

        {{/* DATA PREPARATION*/}}
        {{ $all_people := .Pages }}
        
        {{/* Filter Faculty (To place them first) */}}
        {{ $faculty := where $all_people "Params.group" "faculty" }}
        {{ $faculty_sorted := $faculty.ByTitle }}
        
        {{/*Filter Everyone Else (Students + Staff) */}}
        {{/* We use 'ne' (not equal) to get everyone who is NOT faculty */}}
        {{ $others := where $all_people "Params.group" "ne" "faculty" }}
        {{ $others_sorted := $others.ByTitle }}

        {{/*SINGLE UNIFIED GRID*/}}
        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-x-8 gap-y-12 reveal">
            
            {{/* RENDER FACULTY FIRST */}}
            {{ range $faculty_sorted }}
                {{/* We use 'vertical' style so they fit into the same grid as students */}}
                {{ partial "ui/person-card.html" (dict "page" . "style" "vertical") }}
            {{ end }}

            {{/* RENDER EVERYONE ELSE (Students & Staff mixed, alphabetical) */}}
            {{ range $others_sorted }}
                {{ partial "ui/person-card.html" (dict "page" . "style" "vertical") }}
            {{ end }}
            
        </div>

        {{/*DEBUGGING: Show Uncategorized Profiles*/}}
        {{/* This helps catch profiles that don't have a 'group' set at all */}}
        {{ $uncategorized := where $all_people "Params.group" "eq" nil }}
        {{ if $uncategorized }}
        <div class="mt-20 border-t border-red-200 pt-10">
            <h3 class="text-red-500 font-bold mb-4">Uncategorized Profiles (Missing 'group' tag)</h3>
            <p class="text-xs text-red-400 mb-2">These profiles won't appear above because they have no group. Add `group: student` or `group: staff` to them.</p>
            <ul class="list-disc pl-5 text-red-400 text-sm">
                {{ range $uncategorized }}
                <li>{{ .Title }} (File: {{ .File.Path }})</li>
                {{ end }}
            </ul>
        </div>
        {{ end }}

    </div>
</main>
{{ end }}